
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/AdminCMS/Views/Shared/_Layout.cshtml";
}
@using Microsoft.AspNet.Identity

<section class="content-header">
    <h1>
        ChatGroup
    </h1>
    <p>Bạn đang đăng nhập bằng tài khoản <strong>@User.Identity.GetUserName()</strong>.</p>
    <input type="hidden" id="displayname" value="@User.Identity.GetUserName()" />
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">ChatGroup</li>

    </ol>
</section>
<!-- Main content -->
<section class="content">
    <div class="row">

        <div class="col-md-9 col-lg-offset-1">
            <div class="box box-primary direct-chat direct-chat-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">Chat Nhóm</h3>

                </div><!-- /.box-header -->
                <div class="box-body">
                    <!-- Conversations are loaded here -->
                    <div class="direct-chat-messages" id="discussion">

                    </div><!--/.direct-chat-messages-->
                    <!-- Contacts are loaded here -->

                </div><!-- /.box-body -->
                <div class="box-footer">
                    <form action="#" method="post">
                        <div class="input-group">
                            <input type="text" name="message" id="message" placeholder="Type Message ..." class="form-control">
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-primary btn-flat" id="sendmessage">Send</button>
                            </span>
                        </div>
                    </form>
                </div><!-- /.box-footer-->
            </div><!--/.direct-chat -->


        </div><!-- /.tab-pane -->

    </div><!-- /.tab-content -->

</section><!-- /.content -->
<!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->

<script src="~/scripts/jquery-2.2.3.min.js"></script>
<script src="~/Scripts/jquery.signalR-2.3.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<!--SignalR script to update the chat page and send messages.-->

<script>
        $(function () {
            var image = window.location.origin + "Areas/AdminCMS/dist/img/user1-128x128.jpg";
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, message, date) {
                // Add the message to the page.
                // Message. Default to the left.
                if (name == $('#displayname').val()) {
                    $('#discussion').append(`<div class="direct-chat-msg right">
                                    <div class="direct-chat-info clearfix">
                                        <span class="direct-chat-name pull-right">`+ name + `</span>
                                        <span class="direct-chat-timestamp pull-left">`+ date + `</span>
                                    </div>
                                    <img class="direct-chat-img" src="`+ image + `">
                                    <div class="direct-chat-text">
                                        `+ message + `
                                    </div>
                                </div>`);
                }
                // Message to the right.
                else {
                    $('#discussion').append(`<div class="direct-chat-msg">
                                    <div class="direct-chat-info clearfix">
                                        <span class="direct-chat-name pull-left">`+ name + `</span>
                                        <span class="direct-chat-timestamp pull-right">`+ date + `</span>
                                    </div>
                                    <img class="direct-chat-img" src="`+ image + `" >
                                    <div class="direct-chat-text">
                                        `+ message + `
                                    </div>
                                </div>`);
                }
                $('#discussion').animate({ scrollTop: $('#discussion').prop('scrollHeight') }, 1000);

            };
            chat.client.methodInJavascript = function (name) {

                alert(name);

            };
           

     
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    // Call the Send method on the hub.
                    chat.server.send($('#displayname').val(), $('#message').val());
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });
            });
        });
</script>