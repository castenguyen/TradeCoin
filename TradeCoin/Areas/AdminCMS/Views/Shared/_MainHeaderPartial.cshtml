@using Microsoft.AspNet.Identity
<header class="main-header">
    <!-- Logo -->
    <a href="index2.html" class="logo">
        <!-- mini logo for sidebar mini 50x50 pixels -->
        <span class="logo-mini"><b>N</b>CL</span>
        @ViewBag.SiteName
        <span class="logo-lg">  @ViewBag.SiteName</span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top" role="navigation">
        <!-- Sidebar toggle button-->
        <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
        </a>

        @*using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm", @class = "navbar-right" }))
            {
            @Html.AntiForgeryToken()

            <ul class="nav navbar-nav navbar-right">
                <li>
                    @Html.ActionLink("Hello " + User.Identity.GetUserName() + "!", "Manage", "Account", routeValues: null, htmlAttributes: new { title = "Manage" })
                </li>
                <li><a href="javascript:document.getElementById('logoutForm').submit()">Log off</a></li>
            </ul>
            }*@

        @if (Request.IsAuthenticated)
        {
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">

                    <li class="dropdown messages-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-envelope-o"></i>
                            <span class="label label-success" id="NewEmail1"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header">You have <span id="NewEmail2"></span> email</li>
                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu" id="NewEmail"></ul>
                            </li>
                            <li class="footer"><a href="@Url.Action("Index", "EmailManager", new { area = "AdminCMS" })">See all email</a></li>

                        </ul>
                    </li>

                    <li class="dropdown messages-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-pencil"></i>
                            <span class="label label-success" id="NewPost1"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header">You have <span id="NewPost2"></span> post</li>
                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu" id="NewPost"></ul>
                            </li>
                            @*@if (User.IsInRole("AdminUser") || User.IsInRole("devuser") || User.IsInRole("supperadmin") || User.IsInRole("Mod"))
                            {
                                <li class="footer"><a href="@Url.Action("Index", "ContentItem", new { area = "AdminCMS" })">See all post</a></li>
                            }
                            else
                            {*@
                                <li class="footer"><a href="@Url.Action("ListNews", "Member", new { area = "AdminCMS" })">See all post</a></li>
                            @*}*@
                        </ul>
                    </li>

                    <li class="dropdown messages-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-compress"></i>
                            <span class="label label-success" id="NewKeo1"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header">You have <span id="NewKeo2"></span> keo</li>
                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu" id="NewKeo"></ul>
                            </li>
                            @if (User.IsInRole("AdminUser") || User.IsInRole("devuser") || User.IsInRole("supperadmin") || User.IsInRole("Mod"))
                            {
                                <li class="footer"><a href="@Url.Action("index", "TickerManager", new { area = "AdminCMS" })">See All keo</a></li>
                            }
                            else
                            {
                                <li class="footer"><a href="@Url.Action("ListTicker", "Member", new { area = "AdminCMS" })">See All keo</a></li>
                            }
                        </ul>
                    </li>
                    <li class="dropdown messages-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <i class="fa fa-youtube-play"></i>
                            <span class="label label-success" id="NewVideo1"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="header">You have <span id="NewVideo2"></span> video</li>
                            <li>
                                <!-- inner menu: contains the actual data -->
                                <ul class="menu" id="NewVideo"></ul>
                            </li>
                            @if (User.IsInRole("AdminUser") || User.IsInRole("devuser") || User.IsInRole("supperadmin") || User.IsInRole("Mod"))
                            {
                                <li class="footer"><a href="@Url.Action("VideoManager", "MediaManager", new { area = "AdminCMS" })">See All keo</a></li>
                            }
                            else
                            {
                                <li class="footer"><a href="@Url.Action("ListVideo", "Member", new { area = "AdminCMS" })">See All keo</a></li>
                            }
                            
                        </ul>
                    </li>
                    

                    <!-- Notifications: style can be found in dropdown.less -->
                


                    <li class="dropdown user user-menu">

                        <a class="dropdown-toggle" data-toggle="dropdown"
                           href="@Url.Action("Manage", "AccountAdmin")">
                            Hello @User.Identity.GetUserName()
                        </a>

                        <ul class="dropdown-menu">
                            <!-- User image -->
                            <li class="user-header">
                                @*<img src="~/Areas/AdminCMS/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">*@
                                <p>
                                    @User.Identity.GetUserName()<br>

                                    @if (User.IsInRole("Member"))
                                    {
                                        <span> Member</span>
                                    }
                                    else if (User.IsInRole("Mod"))
                                    {
                                        <span> Mod</span>
                                    }
                                    else if (User.IsInRole("AdminUser"))
                                    {
                                        <span> AdminUser</span>
                                    }


                                </p>
                            </li>
                            <!-- Menu Body
             <li class="user-body">
                 <div class="col-xs-4 text-center">
                     <a href="#">Followers</a>
                 </div>
                 <div class="col-xs-4 text-center">
                     <a href="#">Sales</a>
                 </div>
                 <div class="col-xs-4 text-center">
                     <a href="#">Friends</a>
                 </div>
             </li>
            Menu Footer-->
                            <li class="user-footer">
                                <div class="pull-left">
                                    <a href="@Url.Action("Profile", "AccountAdmin", new { area = "AdminCMS" })" class="btn btn-default btn-flat">Profile</a>
                                </div>
                                <div class="pull-right">
                                    @using (Html.BeginForm("LogOff", "AccountAdmin", FormMethod.Post, new { id = "logoutForm", @class = "navbar-right" }))
                                    {
                                        @Html.AntiForgeryToken()
                                        <a href="javascript:document.getElementById('logoutForm').submit()" class="btn btn-default btn-flat">Log off</a>
                                    }

                                </div>
                            </li>
                        </ul>
                    </li>
                    <!-- Control Sidebar Toggle Button -->
                    @*<li>
            <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
        </li>*@
                </ul>
            </div>
        }

        @*@*<img src="~/Areas/AdminCMS/dist/img/user2-160x160.jpg" class="user-image" alt="User Image">*@
        @*@Html.ActionLink("Hello " + User.Identity.GetUserName() + "!", "Manage", "Account", routeValues: null, htmlAttributes: new { @class="dropdown-toggle",title = "Manage", })*@




    </nav>
</header>

<!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
<script src="~/scripts/jquery-2.2.3.min.js"></script>
<script src="~/Scripts/jquery.signalR-2.3.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<script src="~/Scripts/jquery.playSound.js"></script>
<!--SignalR script to update the chat page and send messages.-->
<script>
    $(function () {
        // Reference the auto-generated proxy for the hub.
        var notificationHub = $.connection.notifiHub;
        // Create a function that the hub can call back to display messages.
        notificationHub.client.notificationNewEmail = function () {
            $("#NewEmail").empty();
            ListNewEmail();
            $.playSound("http://www.noiseaddicts.com/samples_1w72b820/3724.mp3");
        };

        notificationHub.client.notificationNewPost = function () {
            $("#NewPost").empty();
            ListNewPost();
            $.playSound("http://www.noiseaddicts.com/samples_1w72b820/3724.mp3");
        };
        notificationHub.client.notificationNewKeo = function () {
            $("#NewKeo").empty();
            ListNewKeo();
            $.playSound("http://www.noiseaddicts.com/samples_1w72b820/3724.mp3");
        };
        notificationHub.client.notificationNewVideo = function () {
            $("#NewVideo").empty();
            ListNewVideo();
            $.playSound("http://www.noiseaddicts.com/samples_1w72b820/3724.mp3");
        };

        // Start the connection.
        $.connection.hub.start().done(function () {
        });

        ListNewEmail();
        ListNewPost();
        ListNewKeo();
        ListNewVideo();

    });

    function ListNewEmail() {
        coreApp.callAjaxGateway({
            url: 'AdminCMS/EmailManager/GridListBalancesStatement',
            callback: function (data) {
                $("#NewEmail1").text(data.length);
                $("#NewEmail2").text(data.length);
                $.each(data, function (val, text) {
                    $('#NewEmail').append(`<li>
                                        <a href="/chi-tiet-thu?emailId=`+ text.EmailId +`">
                                            <div class="pull-left">
                                                <img src="" class="img-circle" alt="User Image">
                                            </div>
                                            <h4>
                                                `+ text.CrtdUserName + `
                                                <small><i class="fa fa-clock-o"></i> 5 mins</small>
                                            </h4>
                                            <p>`+ text.Content + `</p>
                                        </a>
                                    </li>`);
                });
            }
        });
    }

    function ListNewPost() {
        coreApp.callAjaxGateway({
            url: 'AdminCMS/ContentItem/ListNotificationNewPost',
            callback: function (data) {
                var countNew = 0;
                $.each(data.Rows, function (val, text) {
                    var newpost = "Đã xem";
                    if (text.MicrositeID == 0) {
                        countNew++;
                        newpost = "New Post"; 
                    }
                    $('#NewPost').append(`<li>
                                        <a href="/thanh-vien/chi-tiet-bai-viet?id=`+ text.ContentItemId+`">
                                            <div class="pull-left">
                                                <img src="" class="img-circle" alt="User Image">
                                            </div>
                                            <h4>
                                                `+ text.CrtdUserName + `
                                                <small><i class="fa fa-clock-o"></i>`+ newpost +`</small>
                                            </h4>
                                            <p>`+ text.ContentTitle + `</p>
                                        </a>
                                    </li>`);
                });
                $("#NewPost1").text(countNew);
                $("#NewPost2").text(countNew);
            }
        });
    }

    function ListNewKeo() {
        coreApp.callAjaxGateway({
            url: 'AdminCMS/TickerManager/ListNotificationNewKeo',
            callback: function (data) {
                $("#NewKeo1").text(data.TotalRows);
                $("#NewKeo2").text(data.TotalRows);
                $.each(data.Rows, function (val, text) {
                    $('#NewKeo').append(`<li>
                                        <a href="/thanh-vien/chi-tiet-keo?tickerId=`+ text.TickerId+`">
                                            <div class="pull-left">
                                                <img src="" class="img-circle" alt="User Image">
                                            </div>
                                            <h4>
                                                `+ text.CrtdUserName + `
                                                <small><i class="fa fa-clock-o"></i> 5 mins</small>
                                            </h4>
                                            <p>`+ text.TickerName + `</p>
                                        </a>
                                    </li>`);
                });
            }
        });
    }

    function ListNewVideo() {
        coreApp.callAjaxGateway({
            url: 'AdminCMS/MediaManager/ListNotificationNewKeo',
            callback: function (data) {
                $("#NewVideo1").text(data.TotalRows);
                $("#NewVideo2").text(data.TotalRows);
                $.each(data.Rows, function (val, text) {
                    $('#NewVideo').append(`<li>
                                        <a href="/administrator/EditVideoMedia/`+ text.MediaContentId+`">
                                            <div class="pull-left">
                                                <img src="" class="img-circle" alt="User Image">
                                            </div>
                                            <h4>
                                                `+ text.Filename + `
                                                <small><i class="fa fa-clock-o"></i> 5 mins</small>
                                            </h4>
                                            <p>`+ text.Caption + `</p>
                                        </a>
                                    </li>`);
                });
            }
        });
    }
</script>